<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commodity Price Prediction</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .form-section {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }

        .form-section h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-top: 10px;
            font-weight: bold;
            color: #2c3e50;
        }

        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        /* Centered and larger result */
        .result-container {
            text-align: center;
            margin-top: 20px;
        }

        #result {
            display: none;
            font-size: 24px;
            font-weight: bold;
            color: #d35400;
            background: #fef5e7;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            width: fit-content;
            margin: auto;
        }

        .form-section button[type="submit"] {
            margin-top: 20px;
            padding: 10px;
            background: #28a745;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-section button[type="submit"]:hover {
            background: #218838;
        }
    </style>
</head>
<body class="light">
    <nav>
        <a href="/" style="text-decoration: none; color: inherit;">
            <h1 data-en="Farmer Helper" data-hi="किसान सहायक">Farmer Helper</h1>
        </a>
        <div class="nav-buttons">
            <button id="themeToggle">🌞</button>
            <button id="languageToggle">EN</button>
        </div>
    </nav>

    <header class="hero">
        <div class="hero-content">
            <h1 data-en="Commodity Price Prediction" data-hi="कमोडिटी मूल्य भविष्यवाणी">Commodity Price Prediction</h1>
            <p data-en="Predict the prices of commodities based on market trends" data-hi="बाज़ार प्रवृत्तियों के आधार पर वस्तुओं की कीमतों की भविष्यवाणी करें">
                Predict the prices of commodities based on market trends
            </p>
        </div>
    </header>

    <main>
        <div class="container" style="margin-top: 35px;">
            <div class="form-section">
                <h2 data-en="Get Price Prediction" data-hi="मूल्य भविष्यवाणी प्राप्त करें" style="color: #2c3e50;">Get Price Prediction</h2>
                <form id="predictionForm">
                    <label data-en="Select State:" data-hi="राज्य चुनें:">Select State:</label>
                    <select id="state" name="state">
                        <option value="">-- Select State --</option>
                        {% for state in states %}
                        <option value="{{ state }}">{{ state }}</option>
                        {% endfor %}
                    </select>

                    <label data-en="Select District:" data-hi="जिला चुनें:">Select District:</label>
                    <select id="district" name="district" disabled>
                        <option value="">-- Select District --</option>
                    </select>

                    <label data-en="Select Market:" data-hi="बाजार चुनें:">Select Market:</label>
                    <select id="market" name="market" disabled>
                        <option value="">-- Select Market --</option>
                    </select>

                    <label data-en="Select Commodity:" data-hi="वस्तु चुनें:">Select Commodity:</label>
                    <select id="commodity" name="commodity" disabled>
                        <option value="">-- Select Commodity --</option>
                    </select>

                    <label data-en="Select Variety:" data-hi="प्रकार चुनें:">Select Variety:</label>
                    <select id="variety" name="variety" disabled>
                        <option value="">-- Select Variety --</option>
                    </select>

                    <label data-en="Select Grade:" data-hi="ग्रेड चुनें:">Select Grade:</label>
                    <select id="grade" name="grade" disabled>
                        <option value="">-- Select Grade --</option>
                    </select>

                    <button type="submit">Submit</button>
                </form>
                <div class="result-container">
                    <div id="result"></div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p data-en="© 2024 Farmer Helper. All rights reserved." data-hi="© 2024 किसान सहायक. सर्वाधिकार सुरक्षित।">
            © 2024 Farmer Helper. All rights reserved.
        </p>
    </footer>

    <script src="static/script.js"></script>
    <script>
        $(document).ready(function() {
            // Language toggle logic
            $("#languageToggle").click(function() {
                var isEnglish = $(this).text() === "EN";
                $(this).text(isEnglish ? "हिं" : "EN");

                $("[data-en]").each(function() {
                    var text = isEnglish ? $(this).attr("data-hi") : $(this).attr("data-en");
                    $(this).text(text);
                });
            });

            // Fetch data dynamically
            $("#state").change(function() {
                var state = $(this).val();
                if (state) {
                    $.ajax({
                        url: "/get_options",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({ state: state }),
                        success: function(response) {
                            updateDropdown("#district", response.districts);
                            updateDropdown("#market", response.markets);
                            updateDropdown("#commodity", response.commodities);
                            updateDropdown("#variety", response.varieties);
                            updateDropdown("#grade", response.grades);
                        }
                    });
                } else {
                    resetDropdown("#district");
                    resetDropdown("#market");
                    resetDropdown("#commodity");
                    resetDropdown("#variety");
                    resetDropdown("#grade");
                }
            });

            function updateDropdown(selector, options) {
                var dropdown = $(selector);
                dropdown.empty().append('<option value="">-- Select --</option>');
                options.forEach(function(option) {
                    dropdown.append(new Option(option, option));
                });
                dropdown.prop("disabled", false);
            }

            function resetDropdown(selector) {
                $(selector).empty().append('<option value="">-- Select --</option>').prop("disabled", true);
            }

            // Handle form submission
            $("#predictionForm").submit(function(event) {
                event.preventDefault();
                $.ajax({
                    url: "/predict",
                    type: "POST",
                    data: $(this).serialize(),
                    success: function(response) {
                        $("#result").text(response.predicted_price).fadeIn();
                    }
                });
            });
        });
    </script>
</body>
</html>
